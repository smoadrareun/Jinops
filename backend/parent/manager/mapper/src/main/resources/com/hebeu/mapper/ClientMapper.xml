<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hebeu.mapper.ClientMapper">

    <resultMap id="ClientResultMap" type="com.hebeu.model.ClientModel">
        <id column="id" jdbcType="INTEGER" property="id" />
        <result column="uname" jdbcType="VARCHAR" property="uname" />
        <result column="passwd" jdbcType="VARCHAR" property="passwd" />
        <result column="money" jdbcType="DECIMAL" property="money" />
        <result column="point" jdbcType="DECIMAL" property="point" />
        <result column="defAdd" jdbcType="VARCHAR" property="defAdd" />
        <result column="pic" jdbcType="LONGVARCHAR" property="pic" />
        <collection property="addInfo" javaType="java.util.ArrayList" ofType="com.hebeu.model.ClientModel$AddInfo"
                    select="queryAddInfo" column="id" />
    </resultMap>

    <resultMap id="StandardResultMap" type="com.hebeu.model.ClientModel$AddInfo">
        <id column="id" jdbcType="VARCHAR" property="id" />
        <result column="cliId" jdbcType="INTEGER" property="cliId" />
        <result column="name" jdbcType="VARCHAR" property="name" />
        <result column="phone" jdbcType="BIGINT" property="phone" />
        <result column="address" jdbcType="VARCHAR" property="address" />
        <result column="postcode" jdbcType="VARCHAR" property="postcode" />
        <result column="long_" jdbcType="DECIMAL" property="long_" />
        <result column="lat_" jdbcType="DECIMAL" property="lat_" />
    </resultMap>

    <select id="queryAddInfo" parameterType="java.lang.Integer" resultMap="StandardResultMap">
        SELECT *
        FROM addInfo
        WHERE cliId = #{id,jdbcType=INTEGER}
    </select>

    <select id="login" parameterType="java.util.Map" resultType="java.lang.Integer">
        SELECT COUNT(*)
        FROM client
        WHERE uname = #{uname,jdbcType=VARCHAR}
        AND passwd = #{passwd,jdbcType=VARCHAR}
    </select>

    <select id="selectClientAll" resultMap="ClientResultMap">
        SELECT *
        FROM client
    </select>

    <select id="selectClientById" parameterType="java.lang.Integer" resultMap="ClientResultMap">
        SELECT *
        FROM client
        WHERE id = #{id,jdbcType=INTEGER}
    </select>

    <select id="find" parameterType="java.util.Map" resultMap="ClientResultMap">
        SELECT *
        FROM client
        <where>
            <if test="id != null">
                AND id = #{id,jdbcType=INTEGER}
            </if>
            <if test="uname != null">
                AND uname = #{uname,jdbcType=VARCHAR}
            </if>
            <if test="passwd != null">
                AND passwd = #{passwd,jdbcType=VARCHAR}
            </if>
            <if test="money != null">
                AND money = #{money,jdbcType=DECIMAL}
            </if>
            <if test="point != null">
                AND `point` = #{point,jdbcType=DECIMAL}
            </if>
            <if test="defAdd != null">
                AND defAdd = #{defAdd,jdbcType=INTEGER}
            </if>
            <if test="pic != null">
                AND pic = #{pic,jdbcType=LONGVARCHAR}
            </if>
        </where>
    </select>

    <select id="search" parameterType="java.util.Map" resultMap="ClientResultMap">
        SELECT *
        FROM client
        <where>
            <if test="id != null">
                AND id LIKE CONCAT('%',#{id,jdbcType=INTEGER},'%')
            </if>
            <if test="uname != null">
                AND uname LIKE CONCAT('%',#{uname,jdbcType=VARCHAR},'%')
            </if>
            <if test="passwd != null">
                AND passwd LIKE CONCAT('%',#{passwd,jdbcType=VARCHAR},'%')
            </if>
            <if test="money != null">
                AND money LIKE CONCAT('%',#{money,jdbcType=DECIMAL},'%')
            </if>
            <if test="point != null">
                AND `point` LIKE CONCAT('%',#{point,jdbcType=DECIMAL},'%')
            </if>
            <if test="defAdd != null">
                AND defAdd LIKE CONCAT('%',#{defAdd,jdbcType=INTEGER},'%')
            </if>
            <if test="pic != null">
                AND pic LIKE CONCAT('%',#{pic,jdbcType=LONGVARCHAR},'%')
            </if>
        </where>
    </select>

    <insert id="insert" keyColumn="id" parameterType="java.util.Map" keyProperty="id">
        INSERT INTO client
        (id, uname, passwd, money, `point`, defAdd, pic)
        VALUES(#{id,jdbcType=INTEGER}, #{uname,jdbcType=VARCHAR}, #{passwd,jdbcType=VARCHAR},
              #{money,jdbcType=DECIMAL}, #{point,jdbcType=DECIMAL},
              #{defAdd,jdbcType=VARCHAR}, #{pic,jdbcType=LONGVARCHAR})
    </insert>

    <insert id="insertAddInfo" keyColumn="id" parameterType="java.util.Map" keyProperty="id">
        INSERT INTO addInfo
        (id, cliId, `name`, phone, address, postcode, long_, lat_)
        VALUES
        <foreach collection="addInfo" item="item" index="index" separator=",">
            (#{item.id,jdbcType=VARCHAR}, #{item.cliId,jdbcType=INTEGER}, #{item.name,jdbcType=VARCHAR},
             #{item.phone,jdbcType=BIGINT}, #{item.address,jdbcType=VARCHAR},
             #{item.postcode,jdbcType=VARCHAR}, #{item.long_,jdbcType=DECIMAL}, #{item.lat_,jdbcType=DECIMAL})
        </foreach>
    </insert>

    <delete id="delete" parameterType="java.lang.Integer">
        DELETE
        FROM client
        WHERE id = #{id,jdbcType=INTEGER}
    </delete>

    <delete id="deleteAddInfo" parameterType="java.lang.String">
        DELETE
        FROM addInfo
        WHERE id = #{id,jdbcType=VARCHAR}
    </delete>

    <update id="update" keyColumn="id" parameterType="java.util.Map" useGeneratedKeys="true" keyProperty="id">
        UPDATE client
        <set>
            <if test="uname != null">
                uname = #{uname,jdbcType=VARCHAR},
            </if>
            <if test="passwd != null">
                passwd = #{passwd,jdbcType=VARCHAR},
            </if>
            <if test="money != null">
                money = #{money,jdbcType=DECIMAL},
            </if>
            <if test="point != null">
                `point` = #{point,jdbcType=DECIMAL},
            </if>
            <if test="defAdd != null">
                defAdd = #{defAdd,jdbcType=INTEGER},
            </if>
            <if test="pic != null">
                pic = #{pic,jdbcType=LONGVARCHAR},
            </if>
        </set>
        WHERE id = #{id,jdbcType=INTEGER};
    </update>

    <update id="updateAddInfo" keyColumn="id" parameterType="java.util.Map" useGeneratedKeys="true" keyProperty="id">
        <foreach collection="addInfo" item="item" index="index" separator=";">
            UPDATE addInfo
            <set>
                <if test="item.cliId != null">
                    cliId = #{item.cliId,jdbcType=VARCHAR},
                </if>
                <if test="item.name != null">
                    `name` = #{item.name,jdbcType=VARCHAR},
                </if>
                <if test="item.phone != null">
                    phone = #{item.phone,jdbcType=BIGINT},
                </if>
                <if test="item.address != null">
                    address= #{item.address,jdbcType=VARCHAR},
                </if>
                <if test="item.postcode != null">
                    postcode = #{item.postcode,jdbcType=VARCHAR},
                </if>
                <if test="item.long_ != null">
                    long_ = #{item.long_,jdbcType=DECIMAL},
                </if>
                <if test="item.lat_ != null">
                    lat_ = #{item.lat_,jdbcType=DECIMAL},
                </if>
            </set>
            WHERE id = #{item.id,jdbcType=VARCHAR}
        </foreach>
    </update>
</mapper>